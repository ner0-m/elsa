FROM staging/cuda:10.2 as base
MAINTAINER Tobias Lasser <lasser@in.tum.de>
MAINTAINER David Frank <frankd@in.tum.de>

LABEL Description="Image building code coverage ontop of the CUDA image" 
 
# lcov 1.13 is broken for GCC 8 (see https://github.com/linux-test-project/lcov/issues/38), which is fixed in
# lcov 1.15, so install it from source, got nothing better to do anyway...
RUN set -eux \
  && git clone https://github.com/linux-test-project/lcov.git --single-branch --branch v1.15 /tmp/lcov \
  && cd /tmp/lcov && make install && rm -rf /tmp/lcov \
  && update-alternatives --install /usr/bin/gcov gcov /usr/bin/gcov-8 100 \ 
  && apt autoremove -qqy && apt autoclean -qqy \
  && rm -rf /var/lib/apt/lists/* 
 
# Add Test script 
ADD tests/test_elsa.sh /tmp/tests/test_elsa.sh
 
CMD bash 
