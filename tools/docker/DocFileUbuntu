# Provide an argument to choose the compiler version from the command line
ARG UBUNTU_VERSION=20.04

FROM ubuntu:${UBUNTU_VERSION} as base
MAINTAINER Tobias Lasser <lasser@in.tum.de>
MAINTAINER David Frank <frankd@in.tum.de> 
LABEL Description="default Ubuntu 20.04 with build essentials"
 
# Print some infos about the os 
RUN cat /etc/os-release 
  
# install build tools, cmake, git, ninja
RUN apt-get -qq update \
    && DEBIAN_FRONTEND=noninteractive apt-get --no-install-recommends install -qqy g++ gcc ca-certificates wget git \
        cmake ninja-build python3-pip python3-setuptools python3-dev \
    && pip3 install wheel numpy \
    && rm -rf /var/lib/apt/lists/*

# Be sure that we're using GCC as compiler 
ENV CC=gcc
ENV CXX=g++
 
FROM base as build-onednn

# Add oneDNN install script 
ADD scripts/install_intel-oneDNN.sh /tmp/scripts/install_intel-oneDNN.sh 
 
ARG ONEDNN_VERSION=1.6.2
RUN ./tmp/scripts/install_intel-oneDNN.sh ${ONEDNN_VERSION}

FROM base
COPY --from=build-onednn /tmp/onednn_install /usr/local/
 
ADD tests/test_elsa.sh /tmp/tests/test_elsa.sh

CMD bash
