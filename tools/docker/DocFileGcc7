FROM gcc:7
MAINTAINER Tobias Lasser <lasser@in.tum.de>
LABEL Description="gcc7 on Debian with cmake/git"

# install wget
RUN apt-get -qq update \
 && apt-get install -qqy wget pkg-config

# install ninja
RUN apt-get install -qqy ninja-build

# install OpenSSL for CMake
RUN apt-get install -qqy libssl-dev

# install CMAKE
ARG cmake_version=3.16.1
ARG cmake_version_short=3.16
ARG cmake_dir=cmake-${cmake_version}

RUN wget https://cmake.org/files/v${cmake_version_short}/${cmake_dir}.tar.gz \
 && tar -xvzf ${cmake_dir}.tar.gz \
 && rm ${cmake_dir}.tar.gz \
 && cd ${cmake_dir} \
 && ./configure --parallel=28 \
 && make -j28 && make install \
 && cd .. && rm -rf ${cmake_dir} && ldconfig

# install Intel MKL-DNN
ARG mkldnn_version=1.1.1
ARG mkldnn_folder=v${mkldnn_version}

RUN wget https://github.com/intel/mkl-dnn/archive/${mkldnn_folder}.tar.gz \
 && tar -xvzf ${mkldnn_folder}.tar.gz \
 && rm ${mkldnn_folder}.tar.gz \
 && cd mkl-dnn-${mkldnn_version} \
 && mkdir build && cd build \
 && cmake .. \
 && make -j28 && make install \
 && cd ../.. && rm -rf mkl-dnn-${mkldnn_version} && ldconfig

CMD bash

